<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>병원 정보 조회</title>
</head>
<body>
    <h1>병원 정보 조회</h1>
    <form id="HospitalInfo">
        <input type="text" id="sidoCd" name="sidoCd" placeholder="시도 코드를 입력하세요">
        <input type="text" id="sgguCd" name="sgguCd" placeholder="시군구 코드를 입력하세요">
        <input type="text" id="emdongNm" name="emdongNm" placeholder="읍면동명을 입력하세요">
        <button type="button" onclick="fetchHospitalInfo()">정보 조회</button>
    </form>
    <div id="results"></div>

    <script>
        async function fetchHospitalInfo() {
            const sidoCd = document.getElementById('sidoCd').value;
            const sgguCd = document.getElementById('sgguCd').value;
            const emdongNm = document.getElementById('emdongNm').value;

            try {
                const postResponse = await fetch('/requesthospitalinfo', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        sidoCd: sidoCd,
                        sgguCd: sgguCd,
                        emdongNm: emdongNm
                    })
                });

                if (!postResponse.ok) {
                    throw new Error(`HTTP error! status: ${postResponse.status}`);
                }

                const getResponse = await fetch(`/gethospitalinfo?sidoCd=${sidoCd}&sgguCd=${sgguCd}&emdongNm=${emdongNm}`, {
                    method: 'GET'
                });

                if (!getResponse.ok) {
                    throw new Error(`HTTP error! status: ${getResponse.status}`);
                }

                const data = await getResponse.json();
                let resultHtml = '';
                data.forEach(item => {
                    resultHtml += `
                        <div style="margin-bottom: 20px;">
                            <p><strong>병원명:</strong> ${item.yadmNm}</p>
                            <p><strong>홈페이지:</strong> ${item.hospUrl}</p>
                            <p><strong>전화번호:</strong> ${item.telno}</p>
                            <p><strong>병원종류:</strong> ${item.clCdNm}</p>
                            <p><strong>전문의 수련의 수:</strong> ${item.cmdcResdntCnt}</p>
                            <p><strong>전문의 수:</strong> ${item.cmdcSdrCnt}</p>
                            <p><strong>간호사 수:</strong> ${item.pnursCnt}</p>
                            <p><strong>거리:</strong> ${item.distance}</p>
                            <p><strong>세부 전공 일반의 수:</strong> ${item.detyGdrCnt}</p>
                            <p><strong>세부 전공 인턴 수:</strong> ${item.detyIntnCnt}</p>
                            <p><strong>세부 전공 수련의 수:</strong> ${item.detyResdntCnt}</p>
                            <p><strong>세부 전공 전문의 수:</strong> ${item.detySdrCnt}</p>
                            <p><strong>일반의 수:</strong> ${item.cmdcGdrCnt}</p>
                            <p><strong>인턴 수:</strong> ${item.cmdcIntnCnt}</p>
                            <p><strong>진료과목별 수련의 수:</strong> ${item.mdeptResdntCnt}</p>
                            <p><strong>의사 총 수:</strong> ${item.drTotCnt}</p>
                            <p><strong>진료과목별 일반의 수:</strong> ${item.mdeptGdrCnt}</p>
                            <p><strong>진료과목별 인턴 수:</strong> ${item.mdeptIntnCnt}</p>
                            <p><strong>진료과목별 전문의 수:</strong> ${item.mdeptSdrCnt}</p>
                            <hr>
                        </div>
                    `;
                });
                document.getElementById('results').innerHTML = resultHtml;
            } catch (error) {
                console.error("Error fetching hospital info:", error);
                document.getElementById('results').innerHTML = `오류 발생: ${error.message}`;
            }
        }
    </script>
</body>
</html>